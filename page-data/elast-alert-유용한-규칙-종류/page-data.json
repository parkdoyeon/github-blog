{"componentChunkName":"component---src-templates-post-js","path":"/elast-alert-유용한-규칙-종류","result":{"data":{"markdownRemark":{"html":"<p><a href=\"https://github.com/Yelp/elastalert\">ElastAlert</a>은 조건에 따라 Elasticsearch에서 발생하는 문서에 대한 알럿을 보내주는 오픈소스이다. 각각의 규칙(Rule) yml파일을 생성하면 지정한 Rule 디렉토리에 있는 설정대로 ES에 쿼리하는 구조로,\n직접 파일을 생성해서 관리해줄수도 있고, Kibana에 ElastAlert 플러그인을 추가해서 규칙 관리를 할수도 있다. </p>\n<p>규칙은 다양한 타입이 있는데, ELK 로그 스택을 운영하면서 가장 많이 활용했던 Rule타입은 아래와 같다. 전반적인 내용은 <a href=\"https://elastalert.readthedocs.io/en/latest/ruletypes.html\">공식문서</a>를 참조하면된다.</p>\n<h2 id=\"cardinality-특정-필드의-값의-종류를-제한하고싶을때\"><a href=\"#cardinality-%ED%8A%B9%EC%A0%95-%ED%95%84%EB%93%9C%EC%9D%98-%EA%B0%92%EC%9D%98-%EC%A2%85%EB%A5%98%EB%A5%BC-%EC%A0%9C%ED%95%9C%ED%95%98%EA%B3%A0%EC%8B%B6%EC%9D%84%EB%95%8C\" aria-label=\"cardinality 특정 필드의 값의 종류를 제한하고싶을때 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>cardinality: 특정 필드의 값의 종류를 제한하고싶을때</h2>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> gender alert\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> cardinality\n\n<span class=\"token key atrule\">index</span><span class=\"token punctuation\">:</span> customer<span class=\"token punctuation\">-</span>%Y.%m.%d\n<span class=\"token key atrule\">use_strftime_index</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\n<span class=\"token key atrule\">cardinality_field</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"gender\"</span> <span class=\"token comment\"># 제약을 두고싶은 필드</span>\n<span class=\"token comment\"># 종류의 갯수(반대로 최소값을 설정하고싶으면 min_cardinality으로 세팅)</span>\n<span class=\"token key atrule\">max_cardinality</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2  </span>\n\n<span class=\"token key atrule\">alert_subject</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"남/녀 외의 또 다른 필드값 발생!\"</span></code></pre></div>\n<h2 id=\"metric_aggregation-특정-값의-발생-빈도를-카운팅하고싶을-때\"><a href=\"#metric_aggregation-%ED%8A%B9%EC%A0%95-%EA%B0%92%EC%9D%98-%EB%B0%9C%EC%83%9D-%EB%B9%88%EB%8F%84%EB%A5%BC-%EC%B9%B4%EC%9A%B4%ED%8C%85%ED%95%98%EA%B3%A0%EC%8B%B6%EC%9D%84-%EB%95%8C\" aria-label=\"metric_aggregation 특정 값의 발생 빈도를 카운팅하고싶을 때 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>metric_aggregation: 특정 값의 발생 빈도를 카운팅하고싶을 때</h2>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sql data\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> metric_aggregation\n\n<span class=\"token key atrule\">index</span><span class=\"token punctuation\">:</span> inserted<span class=\"token punctuation\">-</span>sql<span class=\"token punctuation\">-</span>data<span class=\"token punctuation\">-</span>%Y.%m.%d\n<span class=\"token key atrule\">use_strftime_index</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\n<span class=\"token key atrule\">metric_agg_key</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"pk-field\"</span> <span class=\"token comment\"># 카운팅 하고싶은 대상 필드의 이름</span>\n<span class=\"token key atrule\">metric_agg_type</span><span class=\"token punctuation\">:</span> value_count <span class=\"token comment\"># value가 되는 값의 count를 한다는 것을 의미, 숫자크기와 같은 다른 방식의 카운팅방법 지정도 가능하다.</span>\n<span class=\"token key atrule\">query_key</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"pk-field.keyword\"</span> <span class=\"token comment\"># 대상으로 할 value에 대한 쿼리를 넣어주면 된다 </span>\n<span class=\"token key atrule\">max_threshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1 </span><span class=\"token comment\"># 내 경우 중복이 발생하면 무조건 알럿이 와야하므로 최대 갯수는 1개.</span>\n<span class=\"token key atrule\">doc_type</span><span class=\"token punctuation\">:</span> doc\n\n<span class=\"token key atrule\">alert_subject</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"pk-field에 중복된 값이 있습니다.\"</span></code></pre></div>\n<h2 id=\"any-어떤-문서든-발생하면-바로\"><a href=\"#any-%EC%96%B4%EB%96%A4-%EB%AC%B8%EC%84%9C%EB%93%A0-%EB%B0%9C%EC%83%9D%ED%95%98%EB%A9%B4-%EB%B0%94%EB%A1%9C\" aria-label=\"any 어떤 문서든 발생하면 바로 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>any: 어떤 문서든 발생하면 바로!</h2>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Fatal Error\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> any\n\n<span class=\"token key atrule\">index</span><span class=\"token punctuation\">:</span> fatal<span class=\"token punctuation\">-</span>log<span class=\"token punctuation\">-</span>%Y.%m.%d\n<span class=\"token key atrule\">use_strftime_index</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\n<span class=\"token key atrule\">filter</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">query</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">query_string</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">query</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">\"log.level</span><span class=\"token punctuation\">:</span> fatal\"\n\n<span class=\"token key atrule\">alert_subject</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"fatal 에러가 발생했습니다.\"</span></code></pre></div>\n<h2 id=\"frequency-특정-갯수-이상의-문서가-발생했을때\"><a href=\"#frequency-%ED%8A%B9%EC%A0%95-%EA%B0%AF%EC%88%98-%EC%9D%B4%EC%83%81%EC%9D%98-%EB%AC%B8%EC%84%9C%EA%B0%80-%EB%B0%9C%EC%83%9D%ED%96%88%EC%9D%84%EB%95%8C\" aria-label=\"frequency 특정 갯수 이상의 문서가 발생했을때 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>frequency: 특정 갯수 이상의 문서가 발생했을때</h2>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Web Error Alert\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> frequency\n\n<span class=\"token key atrule\">index</span><span class=\"token punctuation\">:</span> web<span class=\"token punctuation\">-</span>log<span class=\"token punctuation\">-</span>%Y.%m.%d\n<span class=\"token key atrule\">use_strftime_index</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\n<span class=\"token comment\"># 10분간 20번의 에러 로그가 발생하면 알럿</span>\n<span class=\"token key atrule\">num_events</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n<span class=\"token key atrule\">timeframe</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">minutes</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n\n<span class=\"token key atrule\">filter</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">query</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">query_string</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">query</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">\"fields.level</span><span class=\"token punctuation\">:</span> error\"\n\n<span class=\"token key atrule\">alert_subject</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"지속적인 에러가 발생했습니다.\"</span></code></pre></div>","timeToRead":2,"excerpt":"ElastAlert은 조건에 따라 Elasticsearch에서 발생하는 문서에 대한 알럿을 보내주는 오픈소스이다. 각각의 규칙(Rule) yml파일을 생성하면 지정한 Rule 디렉토리에 있는 설정대로 ES…","frontmatter":{"title":"ElastAlert - 유용한 규칙 종류","cover":"","date":"2019-05-29T20:07:16.000Z","categories":["ELK"],"tags":["elk","elastalert","elasticsearch"]},"fields":{"slug":"/elast-alert-유용한-규칙-종류","date":"May 28, 2019"}}},"pageContext":{"slug":"/elast-alert-유용한-규칙-종류","nexttitle":"TDD - 셀레니움과 pytest로 브라우저 테스트 코드 작성하기","nextslug":"/tdd-셀레니움과-pytest로-브라우저-테스트-코드-작성하기","prevtitle":"Docker/Docker Compose 설치하고 서비스 시작하기","prevslug":"/docker-docker-compose-설치하고-서비스-시작하기"}}}