{"componentChunkName":"component---src-templates-post-js","path":"/리눅스-도커-lftp로-파일-배포하기","result":{"data":{"markdownRemark":{"html":"<p>CI 서버에서 npm 빌드가 완료되면 빌드된 파일을 ftp 통해서 웹서버에 배포하기로했다.\nCI서버에서 설치하고 쓸 ftp를 찾다가 lftp의 도커 이미지가 있어서 CI 파이프라인에 추가했다.\nlftp는 리눅스에서 많이 사용하는 ftp 프로그램으로, http를 포함한 다양한 프로토콜을 지원한다. 기본적인 명령어 형식은 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">lftp ftp://[user_id]:[user_password]@[host]:[port] -e &quot;mirror -R -n -v -p -X *.md -X *.db -X *.yml -X @html/ -X *.git/ $CI_PROJECT_DIR/vue/vue-proj/dist /R2/vue/vue-proj-1125;&quot;</code></pre></div>\n<p>명령어에 담긴 flag 의미는 아래와 같다</p>\n<ul>\n<li>e: --delete, 동기화 과정중에 없는 파일을 삭제한다</li>\n<li>R: --recursive, 본래 mirror는 [목적지] [로컬] 순서로 디렉토리 표기가 되고 로컬에 목적지에 있는 파일을 다운로드 받는 명령어인데, 반대로 목적지에 파일을 전달하고 싶으면 R 플래그를 넣어줘야 한다.</li>\n<li>n: --only-newer, 새롭게 변경된 파일만 다운로드하기</li>\n<li>v: --verbose, 파일 전송 로그를 표기하기</li>\n<li>p: --no-perms, 작업이 완료되고 리눅스에서 원격에 있는 파일 권한을 변경하려하는데 </li>\n<li>X: --exclude-glob, glob 정규식으로 제외파일을 표기한다. 일반 정규식과 달리 asterisk(*)가 와일드카드 의미를 갖는다.</li>\n</ul>\n<p>자세한 내용 및 더 많은 옵션은 <a href=\"https://lftp.yar.ru/lftp-man.html\">lftp 공식 문서</a>를 통해 확인하면 된다.</p>\n<p>해당 stage 스크립트를  <code class=\"language-text\">gitlab-ci.yml</code>에 작성하니 아래와 같아졌다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">deploy_prod_vue_event:\n    image: registry.mycompany.com:5001/mwienk/docker-lftp:latest\n    stage: deploy\n    variables:\n        GIT_STRATEGY: none\n    script:\n        - echo &quot;Deploy to alpha server&quot;\n        - lftp ftp://deploy:$FTP_PASSWORD@172.0.0.1:2100 -e &quot;mirror -R -n -v -p -X *.md -X *.db -X *.yml -X @html/ -X *.git/ $CI_PROJECT_DIR/vue/vue-proj/dist /R2/vue/vue-proj-1125;&quot;\n    environment:\n        name: production\n    tags:\n        - ci-linux\n    when: manual\n    only:\n    - master</code></pre></div>","timeToRead":1,"excerpt":"CI 서버에서 npm 빌드가 완료되면 빌드된 파일을 ftp 통해서 웹서버에 배포하기로했다.\nCI서버에서 설치하고 쓸 ftp를 찾다가 lftp의 도커 이미지가 있어서 CI 파이프라인에 추가했다.\nlftp는 리눅스에서 많이 사용하는 ftp…","frontmatter":{"title":"리눅스 도커 lftp로 파일 배포하기","cover":"","date":"2019-11-21T11:58:43.000Z","categories":["Dev-Env"],"tags":["docker","ci/cd","ftp"]},"fields":{"slug":"/리눅스-도커-lftp로-파일-배포하기","date":"November 20, 2019"}}},"pageContext":{"slug":"/리눅스-도커-lftp로-파일-배포하기","nexttitle":"리눅스 계정잠금 해제","nextslug":"/리눅스-계정잠금-해제","prevtitle":"Programming Elixir 1 - 원리","prevslug":"/programming-elixir-1-원리"}}}