{"componentChunkName":"component---src-templates-post-js","path":"/elastic-search-403-index-read-only-에러가-발생했을-때","result":{"data":{"markdownRemark":{"html":"<p>어느날 ElasticSearch index에 데이터가 제대로 들어오지 않는 것같아서 logstash의 log를 열어보니 다음과 같은 로그가 여러개 발생해 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">logstash.outputs.elasticsearch<span class=\"token punctuation\">]</span> retrying failed action with response code: <span class=\"token number\">403</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token operator\">=</span><span class=\"token operator\">></span><span class=\"token string\">\"cluster_block_exception\"</span>, <span class=\"token string\">\"reason\"</span><span class=\"token operator\">=</span><span class=\"token operator\">></span>\"blocked by: <span class=\"token punctuation\">[</span>FORBIDDEN/12/index read-only / allow delete <span class=\"token punctuation\">(</span>api<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>그래서 찾아보니 이런 내용의 글이 있었다.</p>\n<p>(원문 페이지: <a href=\"https://discuss.elastic.co/t/forbidden-12-index-read-only-allow-delete-api/110282\">https://discuss.elastic.co/t/forbidden-12-index-read-only-allow-delete-api/110282</a>)</p>\n<p>Edit: i think my problem is low storage. just check your storage first.</p>\n<p>when it's low, kibana auto changes its config to read-only mode. to deal with it, go to your dev tools console and run below command:</p>\n<div class=\"gatsby-highlight\" data-language=\"curl\"><pre class=\"language-curl\"><code class=\"language-curl\">PUT .kibana/_settings\n{\n    &quot;index&quot;: {\n        &quot;blocks&quot;: {\n        &quot;read_only_allow_delete&quot;: &quot;false&quot;\n        }\n    }\n}</code></pre></div>\n<p>즉, ES에 용량대비 데이터가 지나치가 많이 쌓이면 키바나에서 데이터를 read-only모드로 바꾼다는 내용이다.\n실제로 쿼리를 날리니까 문제는 해결됐다. 원문을 잘 읽어보면 '.kibana' 인덱스 자체를 날리고 해결했다는 사람도 있는데,\n대시보드 세팅이 매우 많이 진행 되었기 때문에 그럴순 없었다. (문제를 해결하는 적절한 방법 같지도 않다.)</p>\n<p>찜찜한 마음에 더 찾아보니,\nkibana가 설치가 되어있지 않은 ES에서도 디스크 용량이 가득차면 ES내부 옵션에서 read-only로 바뀐다고한다.\n이럴땐 .kibana 인덱스 말고 전체(_all) 혹은 특정 인덱스 대상으로 아래와 같이 쿼리를 날리면 해결된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"curl\"><pre class=\"language-curl\"><code class=\"language-curl\">PUT _all/_settings\n{\n    &quot;index&quot;: {\n        &quot;blocks&quot;: {\n        &quot;read_only_allow_delete&quot;: &quot;false&quot;\n        }\n    }\n}</code></pre></div>\n<p>kibana 내부 옵션만으로도 데이터 전달이 되지 않는 것을 보면, ES의 insert과정에서 키바나 설정과 동기화되는 요소가 있는 것 같다.</p>","timeToRead":1,"excerpt":"어느날 ElasticSearch index에 데이터가 제대로 들어오지 않는 것같아서 logstash의 log를 열어보니 다음과 같은 로그가 여러개 발생해 있었다. 그래서 찾아보니 이런 내용의 글이 있었다. (원문 페이지: https://discuss…","frontmatter":{"title":"ElasticSearch - 403 index read-only 에러가 발생했을 때","cover":"","date":"2019-03-10T18:24:00.000Z","categories":["ELK"],"tags":["elasticsearch","err"]},"fields":{"slug":"/elastic-search-403-index-read-only-에러가-발생했을-때","date":"March 09, 2019"}}},"pageContext":{"slug":"/elastic-search-403-index-read-only-에러가-발생했을-때","nexttitle":"Git - gitignore 즉시 적용하기","nextslug":"/git-gitignore-즉시-적용하기","prevtitle":"기존 테이블에 PK키 추가하기","prevslug":"/기존-테이블에-pk키-추가하기"}}}