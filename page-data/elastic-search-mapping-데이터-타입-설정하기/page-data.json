{"componentChunkName":"component---src-templates-post-js","path":"/elastic-search-mapping-데이터-타입-설정하기","result":{"data":{"markdownRemark":{"html":"<p>ES는 인덱스를 자동생성된 방식 그대로 사용하기를 권장하지 않는다. 키바나를 올바르게 활용하기 위해서는 템플릿을 통해 인덱스의 데이터 타입 가공이 필요하다. </p>\n<p>가령 키바나에서 1초 이상의 요청시간이 필요한 로그(time:>1000)를 검색하고 싶다면 해당 데이터의 타입은 string이 아닌 integer여야한다.\n자동생성되는 매핑타입은 일반적으로 string keyword 이므로, 템플릿 추가를 통해 인덱스 생성 전에 integer로 타입 지정하도록 설정할 수 있다. </p>\n<p>내가 변경하고자 두 필드는 time_taken과 logdate인데, 이 데이터의 자동으로 생성된 매핑은 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"mapping\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"doc\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//다른 데이터들 생략</span>\n        <span class=\"token property\">\"logdate\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"fields\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"keyword\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span>\n              <span class=\"token property\">\"ignore_above\"</span><span class=\"token operator\">:</span> <span class=\"token number\">256</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"time_taken\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"fields\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"keyword\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span>\n              <span class=\"token property\">\"ignore_above\"</span><span class=\"token operator\">:</span> <span class=\"token number\">256</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>text타입인 위 데이터를 본래의 자료타입과 맞게 integer와 date로 동록하도록 템플릿을 생성하자.</p>\n<p>참고로 \"yyyy-MM-dd hh:mm:ss\"형식인 ISO standard(8601) 시간표기랑 조금 다른 iis 로그(yy-MM-dd hh:mm:ss.SSSS)\"는 년도를 2개까지만 입력하므로, 필드 타입이 없으면 에러가 나기때문에 별도로 형식을 지정해줬다.\n또 소숫점이 없는 경우 insert 에러가 발생할 수 있으므로, malformed 이벤트가 발생해도 인서트가 되도록 \"ignore_malformed\"옵션을 true로 지정해줬다.</p>\n<div class=\"gatsby-highlight\" data-language=\"curl\"><pre class=\"language-curl\"><code class=\"language-curl\">GET _template/kr_change_to_integer\n{\n  &quot;index_patterns&quot;: &quot;kr-*&quot;,\n  &quot;mappings&quot;: {\n    &quot;doc&quot;: {\n      &quot;properties&quot;: {\n        &quot;time_taken&quot;: {\n          &quot;type&quot;: &quot;integer&quot;\n        },\n        &quot;logdate&quot;: {\n          &quot;type&quot;: &quot;date&quot;,\n          &quot;fields&quot;: &quot;yy-MM-dd HH:mm:ss.SSS&quot;,\n          &quot;ignore_malformed&quot;: true\n        }\n      }\n    }\n  }\n}</code></pre></div>\n<p>GET 요청을 통해 등록된 템플릿 내용들을 확인할 수 있다. 내가 직접 등록해놓은 것 말고도 여러가지가 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"curl\"><pre class=\"language-curl\"><code class=\"language-curl\">GET /_template</code></pre></div>\n<p>단순히 리스트만 확인하고싶다면 _cat 쿼리로 확인하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"curl\"><pre class=\"language-curl\"><code class=\"language-curl\">GET /_cat/templates\nname                        index_patterns                order      version\n.data-frame-notifications-1 [.data-frame-notifications-*] 0          7020099\n.ml-state                   [.ml-state*]                  0          7020099\n.ml-config                  [.ml-config]                  0          7020099\n.logstash-management        [.logstash]                   0          \nlogstash                    [logstash-*]                  0          60001\n.monitoring-alerts          [.monitoring-alerts-6]        0          6070299\n.monitoring-es              [.monitoring-es-7-*]          0          7000199\n.monitoring-alerts-7        [.monitoring-alerts-7]        0          7000199\n.watch-history-9            [.watcher-history-9*]         2147483647 \n.monitoring-kibana          [.monitoring-kibana-7-*]      0          7000199\n.monitoring-beats           [.monitoring-beats-7-*]       0          7000199\n.monitoring-logstash        [.monitoring-logstash-7-*]    0          7000199\nsecurity-index-template     [.security-*]                 1000       \n.data-frame-internal-1      [.data-frame-internal-1]      0          7020099\n.watches                    [.watches*]                   2147483647 \nmetricbeat-7.0.1            [metricbeat-7.0.1-*]          1          \n.triggered_watches          [.triggered_watches*]         2147483647 \n.ml-meta                    [.ml-meta]                    0          7020099\n.ml-notifications           [.ml-notifications]           0          7020099\n.management-beats           [.management-beats]           0          70000\nkr_template                 [kr-*]                        0          \n.kibana_task_manager        [.kibana_task_manager]        0          7010199\n.ml-anomalies-              [.ml-anomalies-*]             0          7020099</code></pre></div>\n<p>삭제를 하고싶다면 아래와 같이 하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"curl\"><pre class=\"language-curl\"><code class=\"language-curl\">DELETE /_template/kr_change_to_integer</code></pre></div>\n<p>참고로 템플릿이 등록되면 기존의 매핑이 변경되지 않는다. 새롭게 생성되는 인덱스부터 적용된다.</p>","timeToRead":2,"excerpt":"ES는 인덱스를 자동생성된 방식 그대로 사용하기를 권장하지 않는다. 키바나를 올바르게 활용하기 위해서는 템플릿을 통해 인덱스의 데이터 타입 가공이 필요하다.  가령 키바나에서 1초 이상의 요청시간이 필요한 로그(time:>100…","frontmatter":{"title":"ElasticSearch - mapping 데이터 타입 설정하기","cover":"","date":"2019-02-27T14:18:00.000Z","categories":["ELK"],"tags":["elasticsearch","mapping"]},"fields":{"slug":"/elastic-search-mapping-데이터-타입-설정하기","date":"February 26, 2019"}}},"pageContext":{"slug":"/elastic-search-mapping-데이터-타입-설정하기","nexttitle":"c# - list, array, arraylist의 차이?","nextslug":"/c-list-array-arraylist의-차이","prevtitle":"Git - gitignore 즉시 적용하기","prevslug":"/git-gitignore-즉시-적용하기"}}}