<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.8.0">
    
<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta name="google-site-verification" content="ZPpg1XKRwaiB4lPx6SawBAA96ROVlVBmZ8s6pigFEVc">



<meta name="naver-site-verification" content="a31e494cb7e78d5a64696ea234dc6c9006b251ff">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">


<meta property="og:type" content="website">
<meta property="og:url" content="https://parkdoyeon.github.io/csharp/csharp-2018-12-31-effectivecsharp-2/">


  <meta property="og:title" content="effective c# - 2. 리소스 관리">




  <meta name="description" content="effective c# - 2. 리소스 관리">
  <meta property="og:description" content="effective c# - 2. 리소스 관리">





  <meta name="keywords" content="c#,effectivec#,finalizer,IDisposable,virtual,constructor,">





  <link rel="alternate" href="/atom.xml" title="Park Doyeon">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=">



<link rel="canonical" href="https://parkdoyeon.github.io/csharp/csharp-2018-12-31-effectivecsharp-2/">


<meta name="description" content=".NET 리소스 관리의 이해 finalizer/IDisposable 닷넷은 가비지 수집기가 있기 때문에 개발자가 메모리 해제/누수와 같은 문제를 직접적으로 처리할 필요가 없다. 그러나 비관리 리소스의 경우 관리가 필요하며, 이를 위해 finalizer와 IDisposable 라는 두가지 메커니즘을 제공한다.  finalizer의 경우 가비지로 간주된 이후에">
<meta name="keywords" content="c#,effectivec#,finalizer,IDisposable,virtual,constructor">
<meta property="og:type" content="article">
<meta property="og:title" content="effective c# - 2. 리소스 관리">
<meta property="og:url" content="https://parkdoyeon.github.io/csharp/csharp-2018-12-31-effectivecsharp-2/index.html">
<meta property="og:site_name" content="Park Doyeon">
<meta property="og:description" content=".NET 리소스 관리의 이해 finalizer/IDisposable 닷넷은 가비지 수집기가 있기 때문에 개발자가 메모리 해제/누수와 같은 문제를 직접적으로 처리할 필요가 없다. 그러나 비관리 리소스의 경우 관리가 필요하며, 이를 위해 finalizer와 IDisposable 라는 두가지 메커니즘을 제공한다.  finalizer의 경우 가비지로 간주된 이후에">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-06-08T02:58:52.614Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="effective c# - 2. 리소스 관리">
<meta name="twitter:description" content=".NET 리소스 관리의 이해 finalizer/IDisposable 닷넷은 가비지 수집기가 있기 때문에 개발자가 메모리 해제/누수와 같은 문제를 직접적으로 처리할 필요가 없다. 그러나 비관리 리소스의 경우 관리가 필요하며, 이를 위해 finalizer와 IDisposable 라는 두가지 메커니즘을 제공한다.  finalizer의 경우 가비지로 간주된 이후에">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-141653278-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-141653278-1');
  </script>





  


    <title> effective c# - 2. 리소스 관리 - Park Doyeon </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">Park Doyeon</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>
      </header>

      <div id="post-categories"><ul class="category-list">

    <li>
    
        <a href="/csharp" class="on">C#</a>
    
    </li>

    <li>
    
        <a href="/dev-env">Dev-Env</a>
    
    </li>

    <li>
    
        <a href="/docker">Docker</a>
    
    </li>

    <li>
    
        <a href="/elk">ELK</a>
    
    </li>

    <li>
    
        <a href="/ml">ML</a>
    
    </li>

    <li>
    
        <a href="/python">Python</a>
    
    </li>

    <li>
    
        <a href="/sql">SQL</a>
    
    </li>

    <li>
    
        <a href="/web">Web</a>
    
    </li>

</ul>

      </div>

      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          effective c# - 2. 리소스 관리
        
      </h1>

      <time class="post-time">
          Dec 18 2018
      </time>
    </header>



    
            <div class="post-content">
            <h3 id="NET-리소스-관리의-이해-finalizer-IDisposable"><a href="#NET-리소스-관리의-이해-finalizer-IDisposable" class="headerlink" title=".NET 리소스 관리의 이해 finalizer/IDisposable"></a>.NET 리소스 관리의 이해 finalizer/IDisposable</h3><ol>
<li>닷넷은 가비지 수집기가 있기 때문에 개발자가 메모리 해제/누수와 같은 문제를 직접적으로 처리할 필요가 없다.</li>
<li>그러나 비관리 리소스의 경우 관리가 필요하며, 이를 위해 finalizer와 IDisposable 라는 두가지 메커니즘을 제공한다. </li>
<li>finalizer의 경우 가비지로 간주된 이후에도 메모리 점유시간이 길어져(언제 해제될지도 알 수 없다) 둘 중 IDisposable이 더 권장된다<ul>
<li>가바지로 간주된 객체는 다음 가비지 수집세대에서 삭제되지만</li>
<li>finalizer를 갖고있는 객체는 가비지로 판단되더라도 finalizer를 호출하기 전까지 공간이 해제가 안된다.</li>
</ul>
</li>
</ol>
<h3 id="할당구문보다-멤버-초기화-구문이-좋다"><a href="#할당구문보다-멤버-초기화-구문이-좋다" class="headerlink" title="할당구문보다 멤버 초기화 구문이 좋다."></a>할당구문보다 멤버 초기화 구문이 좋다.</h3><ul>
<li>생성자에서 초기화 코드를 누락하는 경우가 많으므로 변수를 선언하는 곳에서 초기화를 해주는 것이 좋다.</li>
<li>초기화를 하지 않으면 예외가 발생할 위험이 있기 때문이다.</li>
<li>다만 초기화가 필요없는 경우가 있는데, 다음과 같다.<ol>
<li>null이나 0으로 초기화를 하는 경우<ul>
<li>저수준에서 CPU 명령이 메모리블록을 0으로 설정하기때문.</li>
<li>아래 코드는 동일한 0 초기화 구문이다.<pre><code class="c#">{
   MyValType myVal1;
   MyValType myVal2 = new MyValType();
}</code></pre>
</li>
</ul>
</li>
<li>객체를 생성하는 방식이 다를경우 ex) list 객체의 size를 생성자마자 달리 설정하는 것</li>
</ol>
</li>
</ul>
<h3 id="정적-클래스-멤버를-올바르게-초기화하라"><a href="#정적-클래스-멤버를-올바르게-초기화하라" class="headerlink" title="정적 클래스 멤버를 올바르게 초기화하라"></a>정적 클래스 멤버를 올바르게 초기화하라</h3><ul>
<li>정적생성자는 타입 내에 정의된 모든 변수/메서드/속성에 접근하기전에 최초로 접근하는 메서드이다.</li>
<li>복잡한 초기화가 이뤄지는 경우 그 대안으로 사용되기도 한다.<ul>
<li>가령 일반적인 멤버초기화는 예외발생 가능성이 있으면 잡기가 어려운데, 정적생성자의 catch 구문을 통해 복구를 시도할 수 있다.</li>
</ul>
</li>
<li>때문에 private 메서드 사용등의 잘못된 초기화에 유의해야한다<ol>
<li>만일 잘못된 초기화가 이뤄지면 CLR 단계에서 초기화 익셉션이 발생하며,</li>
<li>만약 예외가 발생할 가능성이 있는 정적생성자의 예외를 호출부에서 catch로 잡아버리면 해당 AppDomain이 unload하지 않는 한 해당 객체 생성이 불가능하다.</li>
</ol>
</li>
</ul>
<h3 id="초기화가-중복되는-것을-최소화-하라"><a href="#초기화가-중복되는-것을-최소화-하라" class="headerlink" title="초기화가 중복되는 것을 최소화 하라"></a>초기화가 중복되는 것을 최소화 하라</h3><ul>
<li>생성자를 초기화하는 구문을 두는 방법은 크게 두가지가 있다.<ol>
<li>다양한 변수를 인자로 받는 생성자 오버로딩 + 초기화 할당 메서드 호출</li>
<li>기본값을 매개변수로 하는 생성자 작성 + this(params) 혹은 base(params) 호출 구문을 통해 상속</li>
</ol>
</li>
<li>여기서 두번쨰 방법을 사용하는 것이 좋다.<ul>
<li>전자의 방식을 사용할 경우 생성자 초기화 후에 다시 재 할당이 이뤄지므로 가비지가 생성되며</li>
<li>readonly 예약어가 적용된 변수는 메서드에서 초기화가 불가능하다.</li>
<li>또한 코드가 멤버가 많을수록 오버로드의 경우의 수가 많아져 코드가 장황해질 수 있다</li>
</ul>
</li>
<li>참고) 초기화 우선순위<ol>
<li>정적변수 저장공간 0으로 초기화 -&gt; 변수 초기화</li>
<li>베이스 클래스의 정적 생성자 수행</li>
<li>정적 생성자 수행</li>
<li>인스턴스 변수 저장공간 0으로 초기화 -&gt; 변수 초기화</li>
<li>베이스 클래스의 인스턴스 생성자 수행</li>
<li>인스턴스 생성자 수행</li>
</ol>
</li>
</ul>
<h3 id="불필요한-객체를-만들지-말라"><a href="#불필요한-객체를-만들지-말라" class="headerlink" title="불필요한 객체를 만들지 말라"></a>불필요한 객체를 만들지 말라</h3><ul>
<li>자주 사용되는 지역변수의 경우 멤버 변수로 선언하고 사용해야한다.</li>
<li>string 객체의 경우 문자열이 추가될때마다 string 객체가 다시 생성되므로 StringBuilder를 사용할것을 권장한다.</li>
</ul>
<h3 id="생성자-내에서는-절대로-가상함수-호출을-하지-말라-더-고민해볼것"><a href="#생성자-내에서는-절대로-가상함수-호출을-하지-말라-더-고민해볼것" class="headerlink" title="생성자 내에서는 절대로 가상함수 호출을 하지 말라(더 고민해볼것)"></a>생성자 내에서는 절대로 가상함수 호출을 하지 말라(더 고민해볼것)</h3><ul>
<li>런타임에서는 멤버변수가 초기화 된 다음에 생성자가 수행되는것이 전제되므로, 멤버변수를 사용하는 가상함수가 null 포인터 예외를 방지하기위해 일관성이 없어질 확률(즉 가상메서드가 구현된 메서드를 호출할 위험)이 있다.</li>
<li>이를 극복하려면 베이스 클래스에서 추상함수를 선언하고 파생클래스에서 오버라이드 하면된다. 그러나 </li>
</ul>
<h3 id="표준-Dispose패턴을-구현하라"><a href="#표준-Dispose패턴을-구현하라" class="headerlink" title="표준 Dispose패턴을 구현하라"></a>표준 Dispose패턴을 구현하라</h3><ul>
<li>Dispose 패턴 구현시에 인터페이스 상속을 받는 클래스 멤버중 비관리 리소스가 있으면, 반드시 finalizer를 구현해야한다.<ol>
<li>이용자가 비관리 리소스 정리를 하지 못하는 경우를 대비하기 위한 방어적 코딩이다.</li>
<li>하지만 멤버에 비관리리소스가 없다면 절대 사용하지 말아야한다.</li>
</ol>
</li>
<li>Dispose나 finalizer에서 다른 작업을 수행하면 GC도, Dispose나 finalizer도 닿지 못하는 객체가 생길 수 있다. 이미 정리된 리소스라고 판단되기 때문이다.</li>
</ul>

            </div>
          

    
      <footer class="post-footer">
        <div class="post-tags">
          
            <a href="/tags/c/">c#</a>
          
            <a href="/tags/effectivec/">effectivec#</a>
          
            <a href="/tags/finalizer/">finalizer</a>
          
            <a href="/tags/idisposable/">IDisposable</a>
          
            <a href="/tags/virtual/">virtual</a>
          
            <a href="/tags/constructor/">constructor</a>
          
        </div>

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/csharp/csharp-2019-01-03-effectivecsharp-3/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">effective c# - 3. 제네릭 활용</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/csharp/csharp-2018-12-18-effectivecsharp-1/">
        <span class="next-text nav-default">effective c# - 1. 언어요소</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
    <!--<div style="text-align:center;">
        <button class="btn" id="load-disqus" onclick="disqus.load();">load Disqus review</button>
    </div>-->
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
    2019
    <span class="footer-author">Park Doyeon.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> and <a class="theme-link" href="https://github.com/parkdoyeon">Me</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    

<script type="text/javascript">
  var disqus_shortname = 'parkdoyeon';
  var disqus_identifier = 'csharp/csharp-2018-12-31-effectivecsharp-2/';
  var disqus_url = 'https://parkdoyeon.github.io/csharp/csharp-2018-12-31-effectivecsharp-2/index.html';

  
  var disqus_config = function () {
      this.page.url = disqus_url;
      this.page.identifier = disqus_identifier;
  };
  
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  
  
  // var disqus = {
  //   load : function disqus(){
  //       if(typeof DISQUS !== 'object') {
  //         (function () {
  //         var s = document.createElement('script'); s.async = true;
  //         s.type = 'text/javascript';
  //         s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  //         (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  //         }());
  //         $('#load-disqus').remove(); ///Delete Button
  //       }
  //   }
  // }

</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script src="/js/src/theme.js?v="></script>
<script src="/js/src/bootstrap.js?v="></script>


    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


<script src="/js/src/highlight.pack.js?v="></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.7.0/highlightjs-line-numbers.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
  document.querySelectorAll('figure.highlight').forEach((block) => {
    hljs.highlightBlock(block);
  });
});
hljs.initHighlightingOnLoad();
hljs.initLineNumbersOnLoad();
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </body>
</html>
