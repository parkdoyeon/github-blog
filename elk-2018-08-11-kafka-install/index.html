<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.8.0">
    
<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="kafka - 설치하기">




  <meta name="keywords" content="logger,kafka,zookeeper,">





  <link rel="alternate" href="/default" title="Park Doyeon">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1">



<link rel="canonical" href="https://parkdoyeon.github.io/elk-2018-08-11-kafka-install/">


<meta name="description" content="팀에서 관리하는 웹서버의 로깅시스템을 구축하면서 kafka를 사용하기로 했다. kafka는 서버간 데이터 전달을 위한 브로커 어플리케이션으로, 급격하게 증가하는 데이터를 장애없이 빠르게 보낼수 있는 messaging queue 역할을 한다. kafka를 사용하기로 한 데 있어서 결정적인 요소는 두가지였는데,  게임 사이트, 런처를 관리하는 우리팀의 경우 서">
<meta name="keywords" content="logger,kafka,zookeeper">
<meta property="og:type" content="article">
<meta property="og:title" content="kafka - 설치하기">
<meta property="og:url" content="https://parkdoyeon.github.io/elk-2018-08-11-kafka-install/index.html">
<meta property="og:site_name" content="Park Doyeon">
<meta property="og:description" content="팀에서 관리하는 웹서버의 로깅시스템을 구축하면서 kafka를 사용하기로 했다. kafka는 서버간 데이터 전달을 위한 브로커 어플리케이션으로, 급격하게 증가하는 데이터를 장애없이 빠르게 보낼수 있는 messaging queue 역할을 한다. kafka를 사용하기로 한 데 있어서 결정적인 요소는 두가지였는데,  게임 사이트, 런처를 관리하는 우리팀의 경우 서">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-06-08T02:58:52.617Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kafka - 설치하기">
<meta name="twitter:description" content="팀에서 관리하는 웹서버의 로깅시스템을 구축하면서 kafka를 사용하기로 했다. kafka는 서버간 데이터 전달을 위한 브로커 어플리케이션으로, 급격하게 증가하는 데이터를 장애없이 빠르게 보낼수 있는 messaging queue 역할을 한다. kafka를 사용하기로 한 데 있어서 결정적인 요소는 두가지였는데,  게임 사이트, 런처를 관리하는 우리팀의 경우 서">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  





  


    <title> kafka - 설치하기 - Park Doyeon </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">Park Doyeon</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/resume">
                            
                            
                                Resume
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>
      </header>

      <div id="post-categories"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/csharp/">C#</a></li><li class="category-list-item"><a class="category-list-link" href="/dev-env/">Dev-Env</a></li><li class="category-list-item"><a class="category-list-link" href="/docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/elk/">ELK</a></li><li class="category-list-item"><a class="category-list-link" href="/ml/">ML</a></li><li class="category-list-item"><a class="category-list-link" href="/python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/sql/">SQL</a></li><li class="category-list-item"><a class="category-list-link" href="/web/">Web</a></li></ul>
      </div>

      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          kafka - 설치하기
        
      </h1>

      <time class="post-time">
          Aug 11 2018
      </time>
    </header>



    
            <div class="post-content">
            <p>팀에서 관리하는 웹서버의 로깅시스템을 구축하면서 <a href="https://kafka.apache.org/" target="_blank" rel="noopener">kafka</a>를 사용하기로 했다. kafka는 서버간 데이터 전달을 위한 브로커 어플리케이션으로, 급격하게 증가하는 데이터를 장애없이 빠르게 보낼수 있는 messaging queue 역할을 한다. kafka를 사용하기로 한 데 있어서 결정적인 요소는 두가지였는데,</p>
<ol>
<li>게임 사이트, 런처를 관리하는 우리팀의 경우 서비스는 오픈이나 트래픽을 공격과 같이 급격하게 데이터가 밀려들어오는 이벤트가 자주 발생하고,</li>
<li>기존 로깅시스템에서 사용되던 <a href="https://www.fluentd.org/" target="_blank" rel="noopener">fluntd</a>를 밀어내면서 fluntd의 대용량 처리기능을 보완하는 시스템이 필요했다.</li>
</ol>
<p>아직 테스트 단계라 얼만큼 더 효과적으로 사용되고 있는지 확인하긴 어렵지만, 카프카의 취지와 기능을 고려했을때 현재 로깅 시스템 환경에 적합할 것이라고 판단했다.</p>
<h3 id="kafka와-zookeeper"><a href="#kafka와-zookeeper" class="headerlink" title="kafka와 zookeeper"></a><strong>kafka와 zookeeper</strong></h3><p>kafka는 클러스터링 구성하는데 있어서 분산 시스템을 관리하는(coordination) 기능이 내장되어있지 않고 따로 주키퍼를 사용한다(Apache에서 개발리소스를 생각해서 함께 개발하지 않았다고 한다).</p>
<p>주키퍼는 카프카 application의 정보를 중앙에 집중하고 구성관리, 그룹관리네이밍, 동기화 등의 서비스를 제공한다. 아파치 카프카 공식 사이트에서 작성시점 현재 최신버전인 1.1.1버전을 받으면 함께 인스톨이 된다.</p>
<p>주키퍼는 다수가 되는 서버가 살아있으면 죽은 서비스를 살려내는 구조이므로, 홀수단위로 운용한다. 하지만 카프카 브로커를 1개만 운용한다고 해서 주키퍼 실행하지 않아도 되는 것은 아니므로, <u>반드시 카프카와의 연결 설정파일을 작성하고 먼저 실행을 시켜주도록하자.</u></p>
<h3 id="설치방법"><a href="#설치방법" class="headerlink" title="설치방법"></a><strong>설치방법</strong></h3><ul>
<li>JDK기반으로 돌아가기때문에 실행환경에서는 꼭 자바를 먼저 설치해놓도록 하자.<br>  (나의경우 카프카를 도커 이미지로 빌드했기 때문에 카프카는 볼륨으로 연결해서 실행하고, JDK는 이미지에 직접 설치했다)</li>
</ul>
<ul>
<li><p><a href="https://kafka.apache.org/downloads" target="_blank" rel="noopener">https://kafka.apache.org/downloads</a> 에서 apache에서 권장하는 미러사이트로 tar파일 설치 </p>
<pre><code class="bash">$ wget http://mirror.navercorp.com/apache/kafka/1.1.1/kafka_2.11-1.1.1.tgz</code></pre>
</li>
<li><p>압축풀기</p>
<pre><code class="bash">$ tar -xvf kafka_2.11-1.1.1.tgz</code></pre>
</li>
<li><p>압축푼 폴더명 명령어 입력하기 편하도록 변경하기</p>
<pre><code class="bash">$ mv kafka_2.11-1.1.1 kafka</code></pre>
</li>
</ul>
<h3 id="zookeeper-설정파일-변경하기"><a href="#zookeeper-설정파일-변경하기" class="headerlink" title="zookeeper 설정파일 변경하기"></a><strong>zookeeper 설정파일 변경하기</strong></h3><ul>
<li>하단에 server.id로 입력된 주키퍼 서버 아이디의 넘버값은 dataDir경로에 myid이라는 파일명으로 작성되어있어야한다.</li>
</ul>
<pre><code class="bash">$ cat kafka/zkdata/myid # id가 1인 zookeeper데이터의 id파일
1
$ cd kafka/config
$ vi zookeeper.properties</code></pre>
<pre><code class="yml">
dataDir=/home/user/kafka/zkdata # 주키퍼의 트랜젝션 로그와 스냅샷이 저장되는 저장경로, 직접 편한 경로에 만들어주면 된다.
clientPort=2181 # client가 연결하는 TCP 포트
maxClientCnxns=0 # disable the per-ip limit on the number of connections since this is a non-production config
initLimit=5 # 팔로워가 리더가 초기에 연결하는 시간에 대한 타임아웃 tick 수
syncLimit=2 # 팔로워가 리더와 동기화하는 시간에 대한 타임아웃 tick수 (주키퍼에 저장된 데이터가 크면 늘려야함)

#서버.서버id=서버ip:리더인 경우 팔로워에 연결할 때 사용하는포트:리더 선출 시점에 사용하는 포트
#주키퍼 앙상블 전체의 id값과 서버, 포트를 입력해주면 된다. 나의 경우 같은 서버에 3개의 서비스를 올리려고했기 때문에 포트를 다 다르게 넣어줬다. 한 서버 내에서 리더팔로워 포트만 구분되면 된다.
server.1=localhost:2888:3888
server.2=localhost:2889:3889
server.3=localhost:2890:3890
</code></pre>


<h3 id="kafka-설정파일-변경하기"><a href="#kafka-설정파일-변경하기" class="headerlink" title="kafka 설정파일 변경하기"></a><strong>kafka 설정파일 변경하기</strong></h3><pre><code class="bash">$ vi server.properties</code></pre>
<pre><code class="yml">
broker.id=1 # The id of the broker. This must be set to a unique integer for each broker.
port=9092
delete.topic.enable=true #없으면 토픽삭제시 삭제가 안되므로 반드시 넣자

############################# Socket Server Settings #############################

# The address the socket server listens on. It will get the value returned from
# java.net.InetAddress.getCanonicalHostName() if not configured.
#   FORMAT:
#     listeners = listener_name://host_name:port
#   EXAMPLE:
#     listeners = PLAINTEXT://your.host.name:9092
# listeners=PLAINTEXT://:9092

# Hostname and port the broker will advertise to producers and consumers. If not set,
# it uses the value for &quot;listeners&quot; if configured.  Otherwise, it will use the value
# returned from java.net.InetAddress.getCanonicalHostName().
# 이걸 설정을 안해주면 다른 서버에서 카프카로 통신이 되지 않는다ㅠㅠ
# 심지어 로컬로 다 포트바인딩을 해줬는데도 나는 도커 네트워크를 한번 타서 그랬는지 되지않았음.
advertised.listeners=PLAINTEXT://카프카서버IP:9092

# Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details
#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL

# The number of threads that the server uses for receiving requests from the network and sending responses to the network
num.network.threads=3

# The number of threads that the server uses for processing requests, which may include disk I/O
num.io.threads=8

# The send buffer (SO_SNDBUF) used by the socket server
socket.send.buffer.bytes=102400

# The receive buffer (SO_RCVBUF) used by the socket server
socket.receive.buffer.bytes=102400

# The maximum size of a request that the socket server will accept (protection against OOM)
socket.request.max.bytes=104857600

############################# Log Basics #############################

# A comma separated list of directories under which to store log files
log.dirs=/home/doyeon/kafka/kfdata

# The default number of log partitions per topic. More partitions allow greater
# parallelism for consumption, but this will also result in more files across
# the brokers.
num.partitions=1

# The number of threads per data directory to be used for log recovery at startup and flushing at shutdown.
# This value is recommended to be increased for installations with data dirs located in RAID array.
num.recovery.threads.per.data.dir=1

############################# Internal Topic Settings  #############################
# The replication factor for the group metadata internal topics &quot;__consumer_offsets&quot; and &quot;__transaction_state&quot;
# For anything other than development testing, a value greater than 1 is recommended for to ensure availability such as 3.
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1

############################# Log Retention Policy #############################

# The following configurations control the disposal of log segments. The policy can
# be set to delete segments after a period of time, or after a given size has accumulated.
# A segment will be deleted whenever *either* of these criteria are met. Deletion always happens
# from the end of the log.

# The minimum age of a log file to be eligible for deletion due to age
log.retention.hours=168

# A size-based retention policy for logs. Segments are pruned from the log unless the remaining
# segments drop below log.retention.bytes. Functions independently of log.retention.hours.
#log.retention.bytes=1073741824

# The maximum size of a log segment file. When this size is reached a new log segment will be created.
log.segment.bytes=1073741824

# The interval at which log segments are checked to see if they can be deleted according
# to the retention policies
log.retention.check.interval.ms=300000

############################# zookeeper #############################

# zookeeper connection string (see zookeeper docs for details).
# This is a comma separated host:port pairs, each corresponding to a zk
# server. e.g. &quot;127.0.0.1:3000,127.0.0.1:3001,127.0.0.1:3002&quot;.
# You can also append an optional chroot string to the urls to specify the
# root directory for all kafka znodes.
zookeeper.connect=localhost:2181,localhost:2182,localhost:2183

# Timeout in ms for connecting to zookeeper
zookeeper.connection.timeout.ms=6000

############################# Group Coordinator Settings #############################

# The following configuration specifies the time, in milliseconds, that the GroupCoordinator will delay the initial consumer rebalance.
# The rebalance will be further delayed by the value of group.initial.rebalance.delay.ms as new members join the group, up to a maximum of max.poll.interval.ms.
# The default value for this is 3 seconds.
# We override this to 0 here as it makes for a better out-of-the-box experience for development and testing.
# However, in production environments the default value of 3 seconds is more suitable as this will help to avoid unnecessary, and potentially expensive, rebalances during application startup.
group.initial.rebalance.delay.ms=0
</code></pre>

            </div>
          

    
      <footer class="post-footer">
        <div class="post-tags">
          
            <a href="/tags/logger/">logger</a>
          
            <a href="/tags/kafka/">kafka</a>
          
            <a href="/tags/zookeeper/">zookeeper</a>
          
        </div>

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/csharp-2018-10-14-csharp-basic/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">c# 기본서 - 객체지향</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/web-2018-06-17-ios-distribution/">
        <span class="next-text nav-default">iOS App을 In House로 배포하기</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
    <!--<div style="text-align:center;">
        <button class="btn" id="load-disqus" onclick="disqus.load();">load Disqus review</button>
    </div>-->
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
    2019
    <span class="footer-author">Park Doyeon.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/parkdoyeon">Me</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    

<script type="text/javascript">
  var disqus_shortname = 'parkdoyeon';
  var disqus_identifier = 'elk-2018-08-11-kafka-install/';
  var disqus_url = 'https://parkdoyeon.github.io/elk-2018-08-11-kafka-install/index.html';

  
  var disqus_config = function () {
      this.page.url = disqus_url;
      this.page.identifier = disqus_identifier;
  };
  
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  
  
  // var disqus = {
  //   load : function disqus(){
  //       if(typeof DISQUS !== 'object') {
  //         (function () {
  //         var s = document.createElement('script'); s.async = true;
  //         s.type = 'text/javascript';
  //         s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  //         (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  //         }());
  //         $('#load-disqus').remove(); ///Delete Button
  //       }
  //   }
  // }

</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/highlight.pack.js?v=1.1"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.7.0/highlightjs-line-numbers.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
  document.querySelectorAll('figure.highlight').forEach((block) => {
    hljs.highlightBlock(block);
  });
});
hljs.initHighlightingOnLoad();
hljs.initLineNumbersOnLoad();
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  </body>
</html>
