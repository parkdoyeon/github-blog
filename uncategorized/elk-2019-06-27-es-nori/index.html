<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.8.0">
    
<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta name="google-site-verification" content="ZPpg1XKRwaiB4lPx6SawBAA96ROVlVBmZ8s6pigFEVc">



<meta name="naver-site-verification" content="a31e494cb7e78d5a64696ea234dc6c9006b251ff">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">


<meta property="og:type" content="website">
<meta property="og:url" content="https://parkdoyeon.github.io/uncategorized/elk-2019-06-27-es-nori/">


  <meta property="og:title" content="ElasticSearch 7.2에 한국어 분석기 Nori 플러그인 설치하기">




  <meta name="description" content="ElasticSearch 7.2에 한국어 분석기 Nori 플러그인 설치하기">
  <meta property="og:description" content="ElasticSearch 7.2에 한국어 분석기 Nori 플러그인 설치하기">





  <meta name="keywords" content="elasticsearch,nlp,nori,">





  <link rel="alternate" href="/atom.xml" title="Park Doyeon">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=">



<link rel="canonical" href="https://parkdoyeon.github.io/uncategorized/elk-2019-06-27-es-nori/">


<meta name="description" content="엘라스틱서치가 검색엔진으로서 한국어를 올바르게 인식하도록 하려면 한국어 분석기가 필요하다. 엘라스틱서치 6.4부터 공식적으로 제공하는 한국어 분석 플러그인 Nori는 기본 플러그인이 아니므로 번거롭지만 별도로 설치해줘야한다. 나는 도커로 서버를 운용하기때문에, 엘라스틱서치 공식 도커 이미지에 플러그인만 설치해서 다시 빌드했다. FROM docker.elas">
<meta name="keywords" content="elasticsearch,nlp,nori">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch 7.2에 한국어 분석기 Nori 플러그인 설치하기">
<meta property="og:url" content="https://parkdoyeon.github.io/uncategorized/elk-2019-06-27-es-nori/index.html">
<meta property="og:site_name" content="Park Doyeon">
<meta property="og:description" content="엘라스틱서치가 검색엔진으로서 한국어를 올바르게 인식하도록 하려면 한국어 분석기가 필요하다. 엘라스틱서치 6.4부터 공식적으로 제공하는 한국어 분석 플러그인 Nori는 기본 플러그인이 아니므로 번거롭지만 별도로 설치해줘야한다. 나는 도커로 서버를 운용하기때문에, 엘라스틱서치 공식 도커 이미지에 플러그인만 설치해서 다시 빌드했다. FROM docker.elas">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-07-09T13:36:23.201Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ElasticSearch 7.2에 한국어 분석기 Nori 플러그인 설치하기">
<meta name="twitter:description" content="엘라스틱서치가 검색엔진으로서 한국어를 올바르게 인식하도록 하려면 한국어 분석기가 필요하다. 엘라스틱서치 6.4부터 공식적으로 제공하는 한국어 분석 플러그인 Nori는 기본 플러그인이 아니므로 번거롭지만 별도로 설치해줘야한다. 나는 도커로 서버를 운용하기때문에, 엘라스틱서치 공식 도커 이미지에 플러그인만 설치해서 다시 빌드했다. FROM docker.elas">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-141653278-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-141653278-1');
  </script>





  


    <title> ElasticSearch 7.2에 한국어 분석기 Nori 플러그인 설치하기 - Park Doyeon </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">Park Doyeon</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>
      </header>

      <div id="post-categories"><ul class="category-list">

    <li>
    
        <a href="/dev-env">Dev-Env</a>
    
    </li>

    <li>
    
        <a href="/docker">Docker</a>
    
    </li>

    <li>
    
        <a href="/csharp">C#</a>
    
    </li>

    <li>
    
        <a href="/elk">ELK</a>
    
    </li>

    <li>
    
        <a href="/ml">ML</a>
    
    </li>

    <li>
    
        <a href="/python">Python</a>
    
    </li>

    <li>
    
        <a href="/undefined">python</a>
    
    </li>

    <li>
    
        <a href="/sql">SQL</a>
    
    </li>

    <li>
    
        <a href="/web">Web</a>
    
    </li>

</ul>

      </div>

      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          ElasticSearch 7.2에 한국어 분석기 Nori 플러그인 설치하기
        
      </h1>

      <time class="post-time">
          Jun 27 2019
      </time>
    </header>



    
            <div class="post-content">
            <p>엘라스틱서치가 검색엔진으로서 한국어를 올바르게 인식하도록 하려면 한국어 분석기가 필요하다. 엘라스틱서치 6.4부터 공식적으로 제공하는 한국어 분석 플러그인 Nori는 기본 플러그인이 아니므로 번거롭지만 별도로 설치해줘야한다. 나는 도커로 서버를 운용하기때문에, 엘라스틱서치 공식 도커 이미지에 플러그인만 설치해서 다시 빌드했다.</p>
<pre><code class="dockerfile">FROM docker.elastic.co/elasticsearch/elasticsearch:7.2.0
RUN [&quot;bin/elasticsearch-plugin&quot;, &quot;install&quot;, &quot;analysis-nori&quot;]
CMD bin/elasticsearch</code></pre>
<p>설치후에는 플러그인 동작을 노리에서 제공하는 기본 분석기로 테스트를 해볼 수 있다.</p>
<pre><code class="json">POST _analyze
{
  &quot;explain&quot;: true, 
  &quot;analyzer&quot;: &quot;nori&quot;,
  &quot;text&quot;: &quot;&lt;p&gt;젤다의전설은 링크가 주인공이다.&lt;/p&gt;&quot;,
  &quot;attributes&quot; : [&quot;posType&quot;, &quot;leftPOS&quot;, &quot;rightPOS&quot;, &quot;morphemes&quot;, &quot;reading&quot;] //해당 컬럼이 없으면 전체 필드가 다 노출된다.
}

// Response 200
{
  &quot;detail&quot; : {
    &quot;custom_analyzer&quot; : false,
    &quot;analyzer&quot; : {
      &quot;name&quot; : &quot;org.apache.lucene.analysis.ko.KoreanAnalyzer&quot;,
      &quot;tokens&quot; : [
        {
          &quot;token&quot; : &quot;p&quot;,
          &quot;start_offset&quot; : 1,
          &quot;end_offset&quot; : 2,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 0,
          &quot;leftPOS&quot; : &quot;SL(Foreign language)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;SL(Foreign language)&quot;
        },
        {
          &quot;token&quot; : &quot;젤다&quot;,
          &quot;start_offset&quot; : 3,
          &quot;end_offset&quot; : 5,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 1,
          &quot;leftPOS&quot; : &quot;NNP(Proper Noun)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNP(Proper Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;전설&quot;,
          &quot;start_offset&quot; : 6,
          &quot;end_offset&quot; : 8,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 3,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;링크&quot;,
          &quot;start_offset&quot; : 10,
          &quot;end_offset&quot; : 12,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 5,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;주인&quot;,
          &quot;start_offset&quot; : 14,
          &quot;end_offset&quot; : 16,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 7,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;공&quot;,
          &quot;start_offset&quot; : 16,
          &quot;end_offset&quot; : 17,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 8,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;이&quot;,
          &quot;start_offset&quot; : 17,
          &quot;end_offset&quot; : 18,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 9,
          &quot;leftPOS&quot; : &quot;VCP(Positive designator)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;VCP(Positive designator)&quot;
        },
        {
          &quot;token&quot; : &quot;p&quot;,
          &quot;start_offset&quot; : 22,
          &quot;end_offset&quot; : 23,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 11,
          &quot;leftPOS&quot; : &quot;SL(Foreign language)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;SL(Foreign language)&quot;
        }
      ]
    }
  }
}
</code></pre>
<h1 id="커스터마이즈-하기"><a href="#커스터마이즈-하기" class="headerlink" title="커스터마이즈 하기"></a>커스터마이즈 하기</h1><p>검색결과를 코드로직에서 가공할수도 있지만, 커스텀 분석기를 만들어 더 효율적으로 결과의 내용을 변경할 수 있다. 커스텀 분석기가 잘 적용되는지 테스트를 하기위해 직접 데이터가 있는 인덱스에 붙이지 않고 샘플로 <code>my-custom-analyzer</code>인덱스를 생성한다.</p>
<pre><code class="json">PUT my-custom-analyzer
{
    &quot;settings&quot;:{
        &quot;number_of_shards&quot;: 5,
        &quot;number_of_replicas&quot;: 0,
        &quot;analysis&quot;:{
            &quot;tokenizer&quot;:{
                &quot;kr_bbs_tokenizer&quot;:{
                    &quot;type&quot;:&quot;nori_tokenizer&quot;,
                    &quot;decompound_mode&quot;:&quot;mixed&quot;,
                    //&quot;user_dictionary_rules&quot;: [&quot;젤다의전설 젤다 의 전설&quot;, &quot;성남시 성남 시&quot;, &quot;링크&quot;], 배열로 등록할수도 있고, 아래와 같이 직접 파일로 등록할 수도 있다.
                    &quot;user_dictionary&quot;:&quot;user_dictionary.txt&quot;
                }
            },
            &quot;analyzer&quot;:{
                &quot;nori&quot;:{
                    &quot;type&quot;:&quot;custom&quot;,
                    &quot;tokenizer&quot;:&quot;kr_bbs_tokenizer&quot;
                }
            }
        }
    }
}

</code></pre>
<p>user_dictionary는 단어로 인식할 값들이 들어있는 배열이다. 텍스트 파일의 경우 개행을 통해 단어를, 띄어쓰기를 통해 형식을 구분한다. 띄어쓰기는 첫번째 음절을 명사로, 두번째 음절을 복합명사로 등록한다.</p>
<pre><code class="txt">성남시 성남 시
젤다의전설 젤다 의 전설
링크</code></pre>
<p>해당 파일은 <code>$ELASTICSEARCH-HOME/config/</code>경로에 넣어놓고 등록하면 된다. 도커를 통해 텍스트파일을 마운트하고-&gt;분석기에 파일 등록하고 -&gt;사전 내용 수정을 했는데,커스텀 분석기가 파일이 변경되면 바로 감지를 못하는 것같다. 완성된 사전을 분석기 등록시에 넣어줘야하는지 조금더 확인이 필요한 것같다.</p>
<p><em>주의! (2019-07-06 업데이트)</em><br>노드가 여러개인 경우 각 ES 인스턴스 경로마다 사용자 정의사전 파일을 추가해야한다. 분명히 인덱스 매핑 템플릿 설정은 정상적으로 되는데(경로에 해당파일 없으면 설정도 되지 않는다) ES에서 계속 IOException 로그와 함께 복제 샤드가 샤딩이 잘 안되길래 파일명 바꿔가며 한참 삽질을 한 후에야 깨달았다.</p>
<p>커스텀 분석기를 통해 사전을 적용한 형태소분석 결과값은 아래와 같다.</p>
<pre><code class="json">POST my-custom-analyzer/_analyze
{
  &quot;explain&quot;: true, 
  &quot;analyzer&quot;: &quot;nori&quot;,
  &quot;text&quot;: &quot;&lt;p&gt;젤다의전설은 링크가 주인공이다.&lt;/p&gt;&quot;,
  &quot;attributes&quot; : [&quot;posType&quot;, &quot;leftPOS&quot;, &quot;rightPOS&quot;, &quot;morphemes&quot;, &quot;reading&quot;]
}

// Response 200
{
  &quot;detail&quot; : {
    &quot;custom_analyzer&quot; : true,
    &quot;charfilters&quot; : [ ],
    &quot;tokenizer&quot; : {
      &quot;name&quot; : &quot;my_custom_tokenizer&quot;,
      &quot;tokens&quot; : [
        {
          &quot;token&quot; : &quot;p&quot;,
          &quot;start_offset&quot; : 1,
          &quot;end_offset&quot; : 2,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 0,
          &quot;leftPOS&quot; : &quot;SL(Foreign language)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;SL(Foreign language)&quot;
        },
        {
          &quot;token&quot; : &quot;젤다의전설&quot;,
          &quot;start_offset&quot; : 3,
          &quot;end_offset&quot; : 8,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 1,
          &quot;positionLength&quot; : 3,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : &quot;젤다/NNG(General Noun)+의/NNG(General Noun)+전설/NNG(General Noun)&quot;,
          &quot;posType&quot; : &quot;COMPOUND&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;젤다&quot;,
          &quot;start_offset&quot; : 3,
          &quot;end_offset&quot; : 5,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 1,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;의&quot;,
          &quot;start_offset&quot; : 5,
          &quot;end_offset&quot; : 6,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 2,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;전설&quot;,
          &quot;start_offset&quot; : 6,
          &quot;end_offset&quot; : 8,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 3,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;은&quot;,
          &quot;start_offset&quot; : 8,
          &quot;end_offset&quot; : 9,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 4,
          &quot;leftPOS&quot; : &quot;J(Ending Particle)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;J(Ending Particle)&quot;
        },
        {
          &quot;token&quot; : &quot;링크&quot;,
          &quot;start_offset&quot; : 10,
          &quot;end_offset&quot; : 12,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 5,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;가&quot;,
          &quot;start_offset&quot; : 12,
          &quot;end_offset&quot; : 13,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 6,
          &quot;leftPOS&quot; : &quot;J(Ending Particle)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;J(Ending Particle)&quot;
        },
        {
          &quot;token&quot; : &quot;주인공&quot;,
          &quot;start_offset&quot; : 14,
          &quot;end_offset&quot; : 17,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 7,
          &quot;positionLength&quot; : 2,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : &quot;주인/NNG(General Noun)+공/NNG(General Noun)&quot;,
          &quot;posType&quot; : &quot;COMPOUND&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;주인&quot;,
          &quot;start_offset&quot; : 14,
          &quot;end_offset&quot; : 16,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 7,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;공&quot;,
          &quot;start_offset&quot; : 16,
          &quot;end_offset&quot; : 17,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 8,
          &quot;leftPOS&quot; : &quot;NNG(General Noun)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;NNG(General Noun)&quot;
        },
        {
          &quot;token&quot; : &quot;이&quot;,
          &quot;start_offset&quot; : 17,
          &quot;end_offset&quot; : 18,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 9,
          &quot;leftPOS&quot; : &quot;VCP(Positive designator)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;VCP(Positive designator)&quot;
        },
        {
          &quot;token&quot; : &quot;다&quot;,
          &quot;start_offset&quot; : 18,
          &quot;end_offset&quot; : 19,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 10,
          &quot;leftPOS&quot; : &quot;E(Verbal endings)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;E(Verbal endings)&quot;
        },
        {
          &quot;token&quot; : &quot;p&quot;,
          &quot;start_offset&quot; : 22,
          &quot;end_offset&quot; : 23,
          &quot;type&quot; : &quot;word&quot;,
          &quot;position&quot; : 11,
          &quot;leftPOS&quot; : &quot;SL(Foreign language)&quot;,
          &quot;morphemes&quot; : null,
          &quot;posType&quot; : &quot;MORPHEME&quot;,
          &quot;reading&quot; : null,
          &quot;rightPOS&quot; : &quot;SL(Foreign language)&quot;
        }
      ]
    },
    &quot;tokenfilters&quot; : [ ]
  }
}</code></pre>
<h1 id="필터-세팅하기-nori-part-of-speech"><a href="#필터-세팅하기-nori-part-of-speech" class="headerlink" title="필터 세팅하기: nori_part_of_speech"></a>필터 세팅하기: nori_part_of_speech</h1><p>위에 분석결과를 보면 알 수 있듯이, 한국어의 조사같은 경우는 결과값으로서 의미가 없기때문에 처음부터 분석결과에 제외하는 것이 좋다. 방금 커스터마이즈로 추가한 인덱스에 <code>filter</code>필드의 값으로 필터링할 품사를 넣어주면 된다. 품사에 대한 정보는 <a href="http://lucene.apache.org/core/8_0_0/analyzers-nori/org/apache/lucene/analysis/ko/POS.Tag.html" rel="external nofollow noopener noreferrer" target="_blank">루씬 API문서</a>를 참조하면되고, 설명은 <a href="https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-nori-speech.html" rel="external nofollow noopener noreferrer" target="_blank">nori 공식문서</a>를 참고하면 된다. 하지만 생선된 인덱스를 변경하기 위해서는</p>
<ol>
<li><code>_close</code>으로 인덱스를 닫은 다음</li>
<li>PUT 메소드의 _settings 쿼리를 통해 분석기를 변경하고 <ul>
<li>filter필드를 추가하고, analyzer필드 내부에 filter값을 지정해주면 된다.</li>
</ul>
</li>
<li><code>_open</code>을 통해 다시 열어줘야한다.</li>
</ol>
<pre><code class="json">POST my-custom-analyzer/_close
POST my-custom-analyzer/_settings
{
    &quot;analysis&quot;:{
        &quot;tokenizer&quot;:{
            &quot;my_custom_tokenizer&quot;:{
                &quot;type&quot;:&quot;nori_tokenizer&quot;,
                &quot;decompound_mode&quot;:&quot;mixed&quot;,
                &quot;user_dictionary&quot;:&quot;user_dictionary.txt&quot;
            }
        },
        &quot;analyzer&quot;:{
            &quot;nori&quot;:{
                &quot;type&quot;:&quot;custom&quot;,
                &quot;tokenizer&quot;:&quot;my_custom_tokenizer&quot;,
                &quot;filter&quot;: [
                    &quot;nori_posfilter&quot;
                ]
            }
        },
        &quot;filter&quot;:{
            &quot;nori_posfilter&quot;:{
                &quot;type&quot;:&quot;nori_part_of_speech&quot;,
                &quot;stoptags&quot;: [
                    &quot;E&quot;,&quot;IC&quot;,&quot;J&quot;,&quot;MAG&quot;,&quot;MM&quot;,&quot;NA&quot;,&quot;NR&quot;,&quot;SC&quot;,
                    &quot;SE&quot;,&quot;SF&quot;,&quot;SH&quot;,&quot;SL&quot;,&quot;SN&quot;,&quot;SP&quot;,&quot;SSC&quot;,&quot;SSO&quot;,
                    &quot;SY&quot;,&quot;UNA&quot;,&quot;UNKNOWN&quot;,&quot;VA&quot;,&quot;VCN&quot;,&quot;VCP&quot;,&quot;VSV&quot;,
                    &quot;VV&quot;,&quot;VX&quot;,&quot;XPN&quot;,&quot;XR&quot;,&quot;XSA&quot;,&quot;XSN&quot;,&quot;XSV&quot;
                ]
            }
        }
    }
}
POST my-custom-analyzer/_open</code></pre>
<p>그럼 이제 의도한대로 필터링이 되었는지 확인해보자. anlayze쿼리에 <code>explain: true</code>값이 있으면 필터링이 되지 않으므로 반드시 제외하고 쿼리를 날리자. </p>
<pre><code class="json">POST my-custom-analyzer/_analyze
{
  &quot;analyzer&quot;:&quot;nori&quot;,
  &quot;text&quot;: &quot;&lt;p&gt;젤다의전설은 링크가 주인공이다.&lt;/p&gt;&quot;
}

//Response 200
{
  &quot;tokens&quot; : [
    {
      &quot;token&quot; : &quot;젤다의전설&quot;,
      &quot;start_offset&quot; : 3,
      &quot;end_offset&quot; : 8,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 1,
      &quot;positionLength&quot; : 3
    },
    {
      &quot;token&quot; : &quot;젤다&quot;,
      &quot;start_offset&quot; : 3,
      &quot;end_offset&quot; : 5,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 1
    },
    {
      &quot;token&quot; : &quot;의&quot;,
      &quot;start_offset&quot; : 5,
      &quot;end_offset&quot; : 6,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 2
    },
    {
      &quot;token&quot; : &quot;전설&quot;,
      &quot;start_offset&quot; : 6,
      &quot;end_offset&quot; : 8,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 3
    },
    {
      &quot;token&quot; : &quot;링크&quot;,
      &quot;start_offset&quot; : 10,
      &quot;end_offset&quot; : 12,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 5
    },
    {
      &quot;token&quot; : &quot;주인공&quot;,
      &quot;start_offset&quot; : 14,
      &quot;end_offset&quot; : 17,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 7,
      &quot;positionLength&quot; : 2
    },
    {
      &quot;token&quot; : &quot;주인&quot;,
      &quot;start_offset&quot; : 14,
      &quot;end_offset&quot; : 16,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 7
    },
    {
      &quot;token&quot; : &quot;공&quot;,
      &quot;start_offset&quot; : 16,
      &quot;end_offset&quot; : 17,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 8
    }
  ]
}</code></pre>
<h1 id="템플릿-생성"><a href="#템플릿-생성" class="headerlink" title="템플릿 생성"></a>템플릿 생성</h1><p>이제 테스트해본 설정을 그대로 인덱스 템플릿에 붙이면된다.</p>
<pre><code class="json">PUT _template/kr-board-analyzer-set
{
  &quot;index_patterns&quot;: &quot;kr-board-*&quot;,
  &quot;settings&quot;:{
    &quot;index&quot;: {
      &quot;analysis&quot;:{
        &quot;tokenizer&quot;:{
            &quot;custom_tokenizer&quot;:{
                &quot;type&quot;:&quot;nori_tokenizer&quot;,
                &quot;decompound_mode&quot;:&quot;mixed&quot;,
                &quot;user_dictionary&quot;:&quot;user_dictionary.txt&quot;
            }
        },
        &quot;analyzer&quot;:{
          &quot;custom_analyzer&quot;:{
            &quot;type&quot;:&quot;custom&quot;,
            &quot;tokenizer&quot;:&quot;custom_tokenizer&quot;,
            &quot;filter&quot;: [
                &quot;custom_posfilter&quot;
            ]
          }
        },
        &quot;filter&quot;:{
          &quot;custom_posfilter&quot;:{
            &quot;type&quot;:&quot;nori_part_of_speech&quot;,
            &quot;stoptags&quot;: [
                &quot;E&quot;,&quot;IC&quot;,&quot;J&quot;,&quot;MAG&quot;,&quot;MM&quot;,&quot;NA&quot;,&quot;NR&quot;,&quot;SC&quot;,
                &quot;SE&quot;,&quot;SF&quot;,&quot;SH&quot;,&quot;SL&quot;,&quot;SN&quot;,&quot;SP&quot;,&quot;SSC&quot;,&quot;SSO&quot;,
                &quot;SY&quot;,&quot;UNA&quot;,&quot;UNKNOWN&quot;,&quot;VA&quot;,&quot;VCN&quot;,&quot;VCP&quot;,&quot;VSV&quot;,
                &quot;VV&quot;,&quot;VX&quot;,&quot;XPN&quot;,&quot;XR&quot;,&quot;XSA&quot;,&quot;XSN&quot;,&quot;XSV&quot;
            ]
          }
        }
      }
    }
  },
  &quot;mappings&quot;: {
    &quot;properties&quot;: {
      &quot;obj&quot;: {
        &quot;properties&quot;: {
          &quot;Target&quot;: {
            &quot;properties&quot;: {
              &quot;model&quot;: {
                &quot;properties&quot;: {
                  &quot;Contents&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_analyzer&quot; },
                  &quot;Title&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;custom_analyzer&quot; }
                }
              }
            }
          }
        }
      }
    }
  }
}</code></pre>

            </div>
          

    
      <footer class="post-footer">
        <div class="post-tags">
          
            <a href="/tags/elasticsearch/">elasticsearch</a>
          
            <a href="/tags/nlp/">nlp</a>
          
            <a href="/tags/nori/">nori</a>
          
        </div>

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/elk/elk-2019-06-27-es-replica/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">ElasticSearch - unassigned shard 문제 해결 (3) replica 숫자가 부적절할때</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/docker/docker-2019-06-18-docker-logrotate/">
        <span class="next-text nav-default">Docker 로그로 서버 용량이 꽉찼을 때</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
    <!--<div style="text-align:center;">
        <button class="btn" id="load-disqus" onclick="disqus.load();">load Disqus review</button>
    </div>-->
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
    2019
    <span class="footer-author">Park Doyeon.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> and <a class="theme-link" href="https://github.com/parkdoyeon">Me</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    

<script type="text/javascript">
  var disqus_shortname = 'parkdoyeon';
  var disqus_identifier = 'uncategorized/elk-2019-06-27-es-nori/';
  var disqus_url = 'https://parkdoyeon.github.io/uncategorized/elk-2019-06-27-es-nori/index.html';

  
  var disqus_config = function () {
      this.page.url = disqus_url;
      this.page.identifier = disqus_identifier;
  };
  
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  
  
  // var disqus = {
  //   load : function disqus(){
  //       if(typeof DISQUS !== 'object') {
  //         (function () {
  //         var s = document.createElement('script'); s.async = true;
  //         s.type = 'text/javascript';
  //         s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  //         (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  //         }());
  //         $('#load-disqus').remove(); ///Delete Button
  //       }
  //   }
  // }

</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script src="/js/src/theme.js?v="></script>
<script src="/js/src/bootstrap.js?v="></script>


    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


<script src="/js/src/highlight.pack.js?v="></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.7.0/highlightjs-line-numbers.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
  document.querySelectorAll('figure.highlight').forEach((block) => {
    hljs.highlightBlock(block);
  });
});
hljs.initHighlightingOnLoad();
hljs.initLineNumbersOnLoad();
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </body>
</html>
